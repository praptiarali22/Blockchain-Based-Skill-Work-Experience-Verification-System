<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Approve Certificates</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='view.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.7/dist/sweetalert2.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.7/dist/sweetalert2.min.js"></script>
</head>
<body>
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <script>
                $(document).ready(function() {
                    Swal.fire({
                        title: "Notification",
                        text: "{{ messages[0] }}",
                        icon: "info",
                        confirmButtonText: "OK"
                    });
                });
            </script>
        {% endif %}
    {% endwith %}

    <h2>Pending Job Applications</h2>
    
    {% if enrollments %}
        <table>
            <thead>
                <tr>
                    <th>Job Title</th>
                    <th>Applicant</th>
                    <th>Email</th>
                    <th>Certificate ID</th>
                    <th>Resume</th>
                    <th>Applied On</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for enroll in enrollments %}
                <tr>
                    <td>{{ enroll[1] }}</td>
                    <td>{{ enroll[2] }}</td>
                    <td>{{ enroll[3] }}</td>
                    <td>{{ enroll[4] if enroll[4] else 'None' }}</td>
                    <td>
                        {% if enroll[5] %}
                            <a href="{{ url_for('static', filename='uploads/' + enroll[5]) }}" target="_blank">View Resume</a>
                        {% else %}
                            No resume
                        {% endif %}
                    </td>
                    <td>{{ enroll[6].strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>
                        <form method="POST" action="{{ url_for('update_enrollment_status') }}" style="display: inline;">
                            <input type="hidden" name="enrollment_id" value="{{ enroll[0] }}">
                            <input type="hidden" name="status" value="approved">
                            <button type="submit" style="background-color: #4CAF50;">Approve</button>
                        </form>
                        <form method="POST" action="{{ url_for('update_enrollment_status') }}" style="display: inline;">
                            <input type="hidden" name="enrollment_id" value="{{ enroll[0] }}">
                            <input type="hidden" name="status" value="rejected">
                            <input type="text" name="message" placeholder="Rejection reason" required>
                            <button type="submit" style="background-color: #f44336;">Reject</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No pending applications found.</p>
    {% endif %}
    
    <a href="{{ url_for('hr_dashboard') }}" class="button">Back to Dashboard</a>
</body>
</html>